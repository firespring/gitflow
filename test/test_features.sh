#!/bin/bash
set -e


test_feature_base_functionality()
{
  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE LIST  -----------------"
  echo "------------------------------------------------------"
  git flow feature list
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE START -----------------"
  echo "------------------------------------------------------"
  git flow feature start TP-1234
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE LIST  -----------------"
  echo "------------------------------------------------------"
  git flow feature list
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING RELEASE START -----------------"
  echo "------------------------------------------------------"
  git flow release start r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE FINISH ----------------"
  echo "------------------------------------------------------"
  git flow feature finish TP-1234 r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING RELEASE FINISH ----------------"
  echo "------------------------------------------------------"
  git flow release finish r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE LIST  -----------------"
  echo "------------------------------------------------------"
  git flow feature list
  echo "--------------------- DONE ---------------------------"
}

test_feature_finish_keep()
{
  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE START -----------------"
  echo "------------------------------------------------------"
  git flow feature start TP-1234
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING RELEASE START -----------------"
  echo "------------------------------------------------------"
  git flow release start r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE FINISH ----------------"
  echo "------------------------------------------------------"
  git flow feature finish --keep TP-1234 r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE FINISH ----------------"
  echo "------------------------------------------------------"
  git flow feature finish --keep TP-1234 r751-1
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING FEATURE DELETE ----------------"
  echo "------------------------------------------------------"
  git flow feature delete TP-1234
  echo "--------------------- DONE ---------------------------"


  echo -e "\n\n"
  echo "------------------------------------------------------"
  echo "------------ EXECUTING RELEASE FINISH ----------------"
  echo "------------------------------------------------------"
  git flow release finish r751-1
  echo "--------------------- DONE ---------------------------"
}


TEST_DIR="$1"
if [ "${TEST_DIR}" == "" ]
then
  echo 'No test directory specified'
  exit 1
fi


pushd $TEST_DIR

test_feature_base_functionality
test_feature_finish_keep

popd

